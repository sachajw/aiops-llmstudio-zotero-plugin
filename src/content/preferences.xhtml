<linkset>
  <html:link rel="localization" href="llmstudio-plugin-preferences.ftl" />
</linkset>

<prefpane id="llmstudio-plugin-preferences" onload="Zotero.LLMStudio?.hooks.onPrefsEvent?.('load', { window });">
  <preferences>
    <!-- Server Settings -->
    <preference id="extensions.zotero.llmstudio-zotero.server.enabled"
                name="extensions.zotero.llmstudio-zotero.server.enabled"
                type="bool" />
    <preference id="extensions.zotero.llmstudio-zotero.server.port"
                name="extensions.zotero.llmstudio-zotero.server.port"
                type="int" />
    <preference id="extensions.zotero.llmstudio-zotero.server.host"
                name="extensions.zotero.llmstudio-zotero.server.host"
                type="string" />

    <!-- LLM Studio Connection -->
    <preference id="extensions.zotero.llmstudio-zotero.llmstudio.url"
                name="extensions.zotero.llmstudio-zotero.llmstudio.url"
                type="string" />
    <preference id="extensions.zotero.llmstudio-zotero.llmstudio.model"
                name="extensions.zotero.llmstudio-zotero.llmstudio.model"
                type="string" />

    <!-- Features -->
    <preference id="extensions.zotero.llmstudio-zotero.features.autoSummarize"
                name="extensions.zotero.llmstudio-zotero.features.autoSummarize"
                type="bool" />
    <preference id="extensions.zotero.llmstudio-zotero.features.maxTokens"
                name="extensions.zotero.llmstudio-zotero.features.maxTokens"
                type="int" />
  </preferences>

  <vbox flex="1" style="padding: 10px;">
    <!-- Server Settings -->
    <groupbox style="margin-bottom: 15px;">
      <label><html:h2 data-l10n-id="llmstudio-pref-server-title"></html:h2></label>

      <checkbox
        id="llmstudio-pref-server-enabled"
        preference="extensions.zotero.llmstudio-zotero.server.enabled"
        data-l10n-id="llmstudio-pref-server-enable"
      ></checkbox>

      <hbox align="center" style="margin-top: 10px;">
        <html:label
          for="llmstudio-pref-server-port"
          data-l10n-id="llmstudio-pref-server-port"
          style="min-width: 80px;"
        ></html:label>
        <html:input
          type="number"
          id="llmstudio-pref-server-port"
          preference="extensions.zotero.llmstudio-zotero.server.port"
          min="1024"
          max="65535"
          style="max-width: 100px;"
        ></html:input>
      </hbox>

      <html:div class="llmstudio-hint" data-l10n-id="llmstudio-pref-server-hint" style="margin-top: 8px;"></html:div>
    </groupbox>

    <!-- LLM Studio Connection -->
    <groupbox style="margin-bottom: 15px;">
      <label><html:h2 data-l10n-id="llmstudio-pref-connection-title"></html:h2></label>

      <!-- Provider Preset -->
      <hbox align="center" style="margin-bottom: 10px;">
        <html:label
          for="llmstudio-pref-provider"
          data-l10n-id="llmstudio-pref-provider"
          style="min-width: 100px;"
        ></html:label>
        <html:select id="llmstudio-pref-provider" style="flex: 1; max-width: 200px;">
          <html:option value="llmstudio" data-l10n-id="llmstudio-pref-provider-llmstudio"></html:option>
          <html:option value="ollama">Ollama</html:option>
          <html:option value="openai">OpenAI</html:option>
          <html:option value="anthropic">Anthropic</html:option>
          <html:option value="custom" data-l10n-id="llmstudio-pref-provider-custom"></html:option>
        </html:select>
      </hbox>

      <!-- URL -->
      <hbox align="center" style="margin-bottom: 10px;">
        <html:label
          for="llmstudio-pref-llmstudio-url"
          data-l10n-id="llmstudio-pref-llmstudio-url"
          style="min-width: 100px;"
        ></html:label>
        <html:input
          type="text"
          id="llmstudio-pref-llmstudio-url"
          preference="extensions.zotero.llmstudio-zotero.llmstudio.url"
          placeholder="http://localhost:1234"
          style="flex: 1; max-width: 300px;"
        ></html:input>
      </hbox>

      <!-- Model -->
      <hbox align="center" style="margin-bottom: 10px;">
        <html:label
          for="llmstudio-pref-llmstudio-model"
          data-l10n-id="llmstudio-pref-llmstudio-model"
          style="min-width: 100px;"
        ></html:label>
        <html:input
          type="text"
          id="llmstudio-pref-llmstudio-model"
          preference="extensions.zotero.llmstudio-zotero.llmstudio.model"
          placeholder="Leave empty for default"
          style="flex: 1; max-width: 300px;"
        ></html:input>
      </hbox>

      <!-- Test Connection -->
      <hbox style="margin-top: 10px;">
        <button
          id="llmstudio-test-connection-button"
          data-l10n-id="llmstudio-pref-test-connection"
        ></button>
        <html:span id="connection-test-result" style="line-height: 28px; margin-left: 10px;"></html:span>
      </hbox>
    </groupbox>

    <!-- Feature Settings -->
    <groupbox style="margin-bottom: 15px;">
      <label><html:h2 data-l10n-id="llmstudio-pref-features-title"></html:h2></label>

      <checkbox
        id="llmstudio-pref-auto-summarize"
        preference="extensions.zotero.llmstudio-zotero.features.autoSummarize"
        data-l10n-id="llmstudio-pref-auto-summarize"
      ></checkbox>

      <html:div class="llmstudio-hint" data-l10n-id="llmstudio-pref-auto-summarize-hint" style="margin-left: 24px; margin-bottom: 10px;"></html:div>

      <hbox align="center" style="margin-top: 10px;">
        <html:label
          for="llmstudio-pref-max-tokens"
          data-l10n-id="llmstudio-pref-max-tokens"
          style="min-width: 120px;"
        ></html:label>
        <html:input
          type="number"
          id="llmstudio-pref-max-tokens"
          preference="extensions.zotero.llmstudio-zotero.features.maxTokens"
          min="256"
          max="32768"
          step="256"
          style="max-width: 100px;"
        ></html:input>
      </hbox>
    </groupbox>

    <!-- API Endpoints Info -->
    <groupbox style="margin-bottom: 15px;">
      <label><html:h2 data-l10n-id="llmstudio-pref-api-title"></html:h2></label>
      <html:p data-l10n-id="llmstudio-pref-api-description" style="margin-bottom: 10px; color: #666;"></html:p>

      <vbox style="font-family: monospace; font-size: 11px; background: #f5f5f5; padding: 8px; border-radius: 4px;">
        <html:div>GET  http://localhost:23121/llmstudio/status</html:div>
        <html:div>GET  http://localhost:23121/llmstudio/items</html:div>
        <html:div>POST http://localhost:23121/llmstudio/items</html:div>
        <html:div>POST http://localhost:23121/llmstudio/search</html:div>
      </vbox>
    </groupbox>

    <!-- Help -->
    <vbox>
      <html:label
        data-l10n-id="llmstudio-pref-help"
        data-l10n-args='{"version": "0.1.0"}'
        style="color: #666;"
      ></html:label>
    </vbox>
  </vbox>
</prefpane>
